## å‰è¨€
åˆšå¼€å§‹å­¦ä¹  `Kotlin` å…¶å®æŒºç—›è‹¦çš„ï¼Œç›¸å…³çš„ä¹¦ç±æˆ–è§†é¢‘åå‘äºçŸ¥è¯†ç‚¹çš„è®²è§£ã€‚   
å¼€æºé¡¹ç›®ä¸ºäº†æ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œä»£ç å±‚å±‚å°è£…ï¼Œç”¨æ¥ä¸Šæ‰‹å®åœ¨ä¸åˆé€‚ï¼Œäºæ˜¯ä¾¿æœ‰äº† `fragmject` é¡¹ç›®ã€‚   
åœ¨æ­¤æ„Ÿè°¢ [ç©Android](https://www.wanandroid.com/) æä¾›çš„ [å¼€æ”¾API](https://wanandroid.com/blog/show/2) ã€‚

## ç®€ä»‹
`fragmject` æ˜¯ä¸€ä¸ªä¸ºåˆå­¦è€…å‡†å¤‡çš„ä¸Šæ‰‹é¡¹ç›®ã€‚   
é€šè¿‡å¯¹ `Kotlin` å’Œ `Jetpack` çš„ç³»ç»Ÿè¿ç”¨ï¼Œå®ç°çš„ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡ç¬¦åˆä¸»æµå¸‚åœºæ ‡å‡† Appã€‚   
`fragmject` æ²¡æœ‰å¤æ‚çš„ä¸šåŠ¡å’Œå¤šä½™çš„å°è£…ï¼Œ å®Œå…¨ä¾ç…§ [Android Developer](https://developer.android.google.cn/) å®˜æ–¹çš„å†™æ³•ã€‚   
ä»£ç ç®€å•ï¼Œå†…å®¹å…¨é¢ï¼Œå¿«é€Ÿä¸Šæ‰‹ï¼Œå¯¹ç†è§£å…¶ä»–é¡¹ç›®è®¾è®¡æ€æƒ³å’Œå°è£…æŠ€å·§ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚   

å­¦ä¹ æœ¬é¡¹ç›®ä½ å°†æœ‰å¦‚ä¸‹æ”¶è·ï¼š 
- Kotlinï¼ˆå‡½æ•°è¿›é˜¶ï¼Œæ³›å‹ï¼Œåå°„ï¼Œåç¨‹...ï¼‰ 
- MVVMï¼ˆViewModelï¼ŒLiveData...ï¼‰
- å• Activity åº”ç”¨æ¶æ„ï¼ˆNavigation...ï¼‰
- å¸¸ç”¨å°è£…(å›¾ç‰‡é€‰æ‹©å™¨ã€å›¾ç‰‡ç¼–è¾‘å™¨ã€æ—¥æœŸæ§ä»¶ã€å…¨é¢å±æ²‰æµ¸ã€å±å¹•å½•åˆ¶ã€å­—èŠ‚ç æ’æ¡©...)

## å¼€å‘ç¯å¢ƒ
ä¸ºäº†æ‚¨èƒ½æ­£å¸¸è¿è¡Œæœ¬é¡¹ç›®ï¼Œè¯·ä½¿ç”¨ `Android Studio Bumblebee (2021.1.1) ğŸ` å’Œ `Android Gradle 7.1.2` æˆ–è€…ä»¥ä¸Šç‰ˆæœ¬ã€‚   
[Download Android Studio | Android Developer](https://developer.android.google.cn/studio?hl=zh-cn#downloads/)

## å‰ç½®çŸ¥è¯†
åœ¨å­¦ä¹ å‰å¸Œæœ›æ‚¨èƒ½äº†è§£ä»¥ä¸‹çŸ¥è¯†ï¼Œè¿™å°†å¸®åŠ©æ‚¨æ›´å¿«çš„ä¸Šæ‰‹æœ¬é¡¹ç›®ã€‚
- [Kotlin è¯­è¨€å­¦ä¹  | Android Developer](https://developer.android.google.cn/kotlin/learn?hl=zh_cn)
- [Kotlin ä»£ç ç¤ºä¾‹ | Android Developer](https://play.kotlinlang.org/byExample/overview)
- [ViewBinding ä½¿ç”¨å…¥é—¨ | Android Developer](https://developer.android.google.cn/topic/libraries/view-binding?hl=zh-cn)
- [LiveData ä½¿ç”¨å…¥é—¨ | Android Developer](https://developer.android.google.cn/topic/libraries/architecture/livedata?hl=zh_cn)
- [ViewModel ä½¿ç”¨å…¥é—¨ | Android Developer](https://developer.android.google.cn/topic/libraries/architecture/viewmodel?hl=zh_cn)
- [åç¨‹ ä½¿ç”¨å…¥é—¨ | Android Developer](https://developer.android.google.cn/kotlin/coroutines?hl=zh_cn)
- [Navigation ä½¿ç”¨å…¥é—¨ | Android Developer](https://developer.android.google.cn/guide/navigation/navigation-getting-started?hl=zh_cn)
- [ä¸€æ–‡çœ‹æ‡‚MVVM | æ˜é‡‘](https://juejin.cn/post/7058542176375930887)

## æˆªå›¾å±•ç¤º
| ![1.jpg](https://raw.githubusercontent.com/miaowmiaow/fragmject/master/screenshot/device-2022-03-24-095501.png) | ![2.jpg](https://raw.githubusercontent.com/miaowmiaow/fragmject/master/screenshot/device-2022-03-24-095527.png) | ![3.jpg](https://raw.githubusercontent.com/miaowmiaow/fragmject/master/screenshot/device-2022-03-24-100242.png) |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |

## é¡¹ç›®ç›®å½•ç»“æ„
```
â”œâ”€â”€ app                                  app
|   â””â”€â”€ src 
|       â””â”€â”€ main 
|       |   â””â”€â”€ java                     æºç ç›®å½•
|       |   |   â”œâ”€â”€ activity             Activityç›®å½•
|       |   |   |   â””â”€â”€ MainActivity     é¡¹ç›®å”¯ä¸€Activity
|       |   |   â”œâ”€â”€ adapter              Adapterç›®å½•
|       |   |   â”œâ”€â”€ fragment             Fragmentç›®å½•
|       |   |   â”œâ”€â”€ model                ViewModelç›®å½•
|       |   |   â””â”€â”€ App                  Application
|       |   |
|       |   â””â”€â”€ res                      èµ„æºç›®å½•
|       |   |   â””â”€â”€ navigation           å¯¼èˆªå›¾ç›®å½•
|       |   |
|       |   â””â”€â”€ AndroidManifest.xml      é…ç½®æ–‡ä»¶
|       |
|       â””â”€â”€ build.gradle                 æ¨¡å—æ„å»ºé…ç½®
|       â””â”€â”€ channel                      æ¸ é“é…ç½®æ–‡ä»¶
|       â””â”€â”€ dictionary                   è‡ªå®šä¹‰æ··æ·†å­—å…¸
|       â””â”€â”€ proguard-rules.pro           ä»£ç æ··æ·†é…ç½®æ–‡ä»¶
| 
â”œâ”€â”€ library-base                         åŸºç¡€libraryï¼ˆå­˜æ”¾é€šç”¨å°è£…æºç ï¼‰
|   â””â”€â”€ src 
|       â””â”€â”€ main 
|       |   â”œâ”€â”€ assets                   åŸç”Ÿæ–‡ä»¶ç›®å½•
|       |   â””â”€â”€ java                     æºç ç›®å½•
|       |       â”œâ”€â”€ bus                  æ¶ˆæ¯æ€»çº¿ç›®å½•
|       |       â”œâ”€â”€ db                   Databaseç›®å½•
|       |       â”œâ”€â”€ dialog               Dialogç›®å½•
|       |       â”œâ”€â”€ http                 ç½‘ç»œè¯·æ±‚ç›®å½•
|       |       â”œâ”€â”€ provider             ContentProviderç›®å½•
|       |       â”œâ”€â”€ utils                å·¥å…·ç±»ç›®å½•
|       |       â””â”€â”€ view                 è‡ªå®šä¹‰viewç›®å½•
|       | 
|       â””â”€â”€ build.gradle                 æ¨¡å—æ„å»ºé…ç½®
| 
â”œâ”€â”€ library-common                       å…¬å…±libraryï¼ˆå­˜æ”¾å„ä¸ª module å…¬ç”¨æºç åŠèµ„æºï¼‰
|   â””â”€â”€ src 
|       â””â”€â”€ main 
|       |   â””â”€â”€ java                     æºç ç›®å½•
|       |       â”œâ”€â”€ bean                 å®ä½“ç±»ç›®å½•
|       |       â””â”€â”€ constant             å¸¸é‡é…ç½®ç›®å½•
|       | 
|       â””â”€â”€ build.gradle                 æ¨¡å—æ„å»ºé…ç½®
| 
â”œâ”€â”€ miaow-picture                        å›¾ç‰‡ç¼–è¾‘å™¨æ¨¡å—ï¼ˆç›®å½•åŒappï¼Œä¸å†å±•å¼€ï¼‰
â”œâ”€â”€ miaow-plugin                         æ’ä»¶æ¨¡å—
|   â””â”€â”€ src 
|       â””â”€â”€ main 
|           â””â”€â”€ groovy                   æºç ç›®å½•
|           | 
|           â””â”€â”€ resources                é…ç½®ç›®å½•
|               â””â”€â”€ statistic.properties æ’ä»¶é…ç½®
â”œâ”€â”€ module-user                          ç”¨æˆ·æ¨¡å—ï¼ˆç›®å½•åŒappï¼Œä¸å†å±•å¼€ï¼‰
â”œâ”€â”€ module-wan                           ç©AndroidåŠŸèƒ½æ¨¡å—ï¼ˆç›®å½•åŒappï¼Œä¸å†å±•å¼€ï¼‰
| 
â”œâ”€â”€ repos                                æ’ä»¶ç”Ÿæˆç›®å½•
|
â”œâ”€â”€ build.gradle                         é¡¹ç›®æ„å»ºé…ç½®
â”œâ”€â”€ config.gradle                        gradleç¼–è¯‘æ–‡ä»¶ gradleä¾èµ–é…ç½®
â”œâ”€â”€ config.properties                    é¡¹ç›®é…ç½®
â”œâ”€â”€ gradle.properties                    gradleé…ç½®
â””â”€â”€ settings.gradle                      é¡¹ç›®ä¾èµ–é…ç½®
```

## KVDatabase
é€šè¿‡å¯¹ `RoomDatabase` è¿›è¡Œå°è£…ï¼Œä»è€Œæ›´æ–¹ä¾¿çš„å®ç°æ•°æ®æŒä¹…åŒ–ã€‚   

#### å¿«é€Ÿä½¿ç”¨
```
// å­˜å‚¨æ•°æ®
KVDatabase.set(key: String, value: String)

// è·å–æ•°æ®
KVDatabase.get(key: String)
```

## WebView ä¼˜åŒ–åŠ H5 ç§’å¼€å®è·µ
[æ»¡æ»¡çš„ WebView ä¼˜åŒ–å¹²è´§ï¼Œè®©ä½ çš„ H5 å®ç°ç§’å¼€ä½“éªŒ](https://juejin.cn/post/7043706765879279629)

## SharedFlowBus
åŸºäº `SharedFlow` å°è£…çš„æ¶ˆæ¯æ€»çº¿ã€‚   

[SharedFlowBusï¼š30è¡Œä»£ç å®ç°æ¶ˆæ¯æ€»çº¿ä½ ç¡®å®šä¸çœ‹å—](https://juejin.cn/post/7028067962200260615)

#### å¿«é€Ÿä½¿ç”¨
```
// å‘é€æ¶ˆæ¯
SharedFlowBus.with(objectKey: Class<T>).tryEmit(value: T)

// å‘é€ç²˜æ€§æ¶ˆæ¯
SharedFlowBus.withSticky(objectKey: Class<T>).tryEmit(value: T)

// è®¢é˜…æ¶ˆæ¯
SharedFlowBus.on(objectKey: Class<T>).observe(owner){ it ->
    println(it)
}

// è®¢é˜…ç²˜æ€§æ¶ˆæ¯
SharedFlowBus.onSticky(objectKey: Class<T>).observe(owner){ it ->
    println(it)
}
```

## å­—èŠ‚ç æ’æ¡©
[æœ€é€šä¿—æ˜“æ‡‚çš„å­—èŠ‚ç æ’æ¡©å®æˆ˜ â€”â€” ä¼˜é›…çš„æ‰“å°æ–¹æ³•æ‰§è¡Œæ—¶é—´](https://juejin.cn/post/6986848837797658637)

[æœ€é€šä¿—æ˜“æ‡‚çš„å­—èŠ‚ç æ’æ¡©å®æˆ˜ â€”â€” è‡ªåŠ¨åŸ‹ç‚¹](https://juejin.cn/post/6985366891447451662)

#### éšç§åˆè§„ â€”â€”â€”â€” æ›¿æ¢ç›®æ ‡å­—æ®µæˆ–æ–¹æ³•
åœ¨ `MiaowPlugin` æ·»åŠ  `ScanBean` å¹¶é…ç½®ç›®æ ‡å­—æ®µæˆ–æ–¹æ³•ä»¥åŠå¯¹åº”çš„æ›¿æ¢å­—æ®µæˆ–æ–¹æ³•
```
ScanBean(
    owner = "android/os/Build",
    name = "BRAND",
    desc = "Ljava/lang/String;",
    replaceOpcode = Opcodes.INVOKESTATIC,
    replaceOwner = "com/example/fragment/library/common/utils/BuildUtils",
    replaceName = "getBrand",
    "()Ljava/lang/String;"
)
```
#### æ€§èƒ½æ‰«æ â€”â€”â€”â€” æ‰“å°æ–¹æ³•æ‰§è¡Œæ—¶é—´
åœ¨ `MiaowPlugin` æ·»åŠ  `TimeBean` å¹¶é…ç½®æ‰“å°ç›®æ ‡æˆ–èŒƒå›´
```
TimeBean( //ä»¥åŒ…åå’Œæ‰§è¡Œæ—¶é—´ä¸ºæ¡ä»¶
    "com/example/fragment/library/base",
    time = 50L
)
```
#### æ€§èƒ½æ‰«æ â€”â€”â€”â€” æ‰“å°æ–¹æ³•æ‰§è¡Œæ—¶é—´
åœ¨ `MiaowPlugin` æ·»åŠ  `TraceBean` å¹¶é…ç½®åŸ‹ç‚¹ç›®æ ‡ä»¥åŠå¯¹åº”åŸ‹ç‚¹æ–¹æ³•
```
TraceBean(
    owner = "Landroid/view/View\$OnClickListener;",
    name = "onClick",
    desc = "(Landroid/view/View;)V",
    traceOwner = "com/example/fragment/library/common/utils/StatisticHelper",
    traceName = "viewOnClick",
    traceDesc = "(Landroid/view/View;)V" //å‚æ•°åº”åœ¨descèŒƒå›´ä¹‹å†…
)
```

é…ç½®å®Œæˆå `gradle` æ‰§è¡Œ `publish` ä»»åŠ¡ç”Ÿæˆæ’ä»¶
åœ¨æ ¹ç›®å½• `setting.gradle` æ·»åŠ æœ¬åœ°æ’ä»¶æº
```
pluginManagement {
    repositories {
        maven {
            url uri('repo')
        }
    }
}
```
åœ¨æ ¹ç›®å½• `build.gradle` æ·»åŠ æ’ä»¶ä¾èµ–
```
buildscript {
    dependencies {
        classpath 'com.example.miaow:plugin:1.0.0'
    }
}
```
åœ¨appç›®å½• `build.gradle` applyæ’ä»¶
```
plugins {
    id 'miaow'
}
```

## åŠ¨æ€æƒé™ç”³è¯·
[è‡ªå·±åŠ¨æ‰‹æ’¸ä¸€ä¸ªåŠ¨æ€æƒé™ç”³è¯·åº“](https://juejin.cn/post/6991471901704978440)

## å›¾ç‰‡ç¼–è¾‘å™¨
[è‡ªå·±åŠ¨æ‰‹æ’¸ä¸€ä¸ªå›¾ç‰‡ç¼–è¾‘å™¨ï¼ˆæ”¯æŒé•¿å›¾ï¼‰](https://juejin.cn/post/7013274417766039560)
### æˆªå›¾å±•ç¤º
| ![5.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4676b80c4f4b4b99821f9d36d1e78e9b~tplv-k3u1fbpfcp-watermark.awebp?) | ![6.gif](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3a12c1c4bc524c9fa3edcea71e95d71f~tplv-k3u1fbpfcp-watermark.awebp?) | ![7.gif](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c448aaa731f47e8b63ffe54ba25ad5b~tplv-k3u1fbpfcp-watermark.awebp?) |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
#### å¿«é€Ÿä½¿ç”¨
```
PictureEditorDialog.newInstance()
    .setBitmapPath(path)
    .setEditorFinishCallback(object : EditorFinishCallback {
        override fun onFinish(path: String) {
            val bitmap = BitmapFactory.decodeFile(path, BitmapFactory.Options())
        }
    })
    .show(childFragmentManager)
```
å¦‚ä¸Šæ‰€ç¤ºï¼š
1. é€šè¿‡ `PictureEditorDialog` è°ƒç”¨å›¾ç‰‡ç¼–è¾‘å™¨
2. é€šè¿‡ `setBitmapPath(path)` ä¼ å…¥å›¾ç‰‡è·¯å¾„
3. é€šè¿‡ `setEditorFinishCallback(callback)` è·å–ç¼–è¾‘åçš„å›¾ç‰‡åœ°å€

å¦‚æœè§‰å¾— `PictureEditorDialog` ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œè¿˜å¯ä»¥é€šè¿‡ `PictureEditorView` æ¥è‡ªå®šä¹‰æ ·å¼
#### è‡ªå®šä¹‰ä½¿ç”¨
```
<com.example.miaow.picture.editor.PictureEditorView
    android:id="@+id/pic_editor"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```
```
picEditor.setBitmapPath(path)
picEditor.setMode(PictureEditorView.Mode.STICKER)
picEditor.setGraffitiColor(Color.parseColor("#ffffff"))
picEditor.setSticker(StickerAttrs(bitmap))
picEditor.graffitiUndo()
picEditor.mosaicUndo()
picEditor.saveBitmap()
```
å¦‚ä¸Šæ‰€ç¤ºï¼š
1. é€šè¿‡ `setBitmapPath(path)` ä¼ å…¥å›¾ç‰‡è·¯å¾„
2. é€šè¿‡ `setMode(mode)` è®¾ç½®ç¼–è¾‘æ¨¡å¼ï¼Œåˆ†åˆ«æœ‰ï¼šæ¶‚é¸¦ï¼Œæ©¡çš®æ“¦ï¼Œé©¬èµ›å…‹ï¼Œè´´çº¸
3. é€šè¿‡ `setGraffitiColor(color)` è®¾ç½®æ¶‚é¸¦ç”»ç¬”é¢œè‰²
4. é€šè¿‡ `setSticker(StickerAttrs(bitmap))` è®¾ç½®è´´çº¸
5. é€šè¿‡ `graffitiUndo()` æ¶‚é¸¦æ’¤é”€
6. é€šè¿‡ `mosaicUndo()` é©¬èµ›å…‹æ’¤é”€
7. é€šè¿‡ `saveBitmap()` ä¿å­˜ç¼–è¾‘å›¾ç‰‡

`PictureEditorView` å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œå…·ä½“ä½¿ç”¨è¯·æŸ¥çœ‹ `PictureEditorDialog`
#### å›¾ç‰‡è£å‰ª
```
<com.example.miaow.picture.editor.PictureClipView
    android:id="@+id/clip"
    android:layout_width="match_parent"
    android:layout_height="match_parent" />
```
```
clip.setBitmapResource(bitmap)
clip.rotate()
clip.reset()
clip.saveBitmap()
```
å¦‚ä¸Šæ‰€ç¤ºï¼š
1. é€šè¿‡ `setBitmapResource(bitmap)` ä¼ å…¥è£å‰ªå›¾ç‰‡
2. é€šè¿‡ `clip.rotate()` å›¾ç‰‡æ—‹è½¬
3. é€šè¿‡ `clip.reset()` å›¾ç‰‡é‡ç½®
4. é€šè¿‡ `clip.saveBitmap()` ä¿å­˜è£å‰ªæ¡†å†…å›¾ç‰‡

`PictureClipView` å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œå…·ä½“ä½¿ç”¨è¯·æŸ¥çœ‹ `PictureClipDialog`

## ä¸»è¦å¼€æºæ¡†æ¶
- [coil-kt/coil](https://github.com/coil-kt/coil)
- [google/gson](https://github.com/google/gson)
- [sourceforge/pinyin4j](http://pinyin4j.sourceforge.net/)
- [square/okhttp](https://github.com/square/okhttp)
- [square/retrofit](https://github.com/square/retrofit)
- [tencent/x5](https://x5.tencent.com/)

## Giteeé•œåƒ
- [fragmject](https://gitee.com/zhao.git/FragmentProject.git)

## About me
- QQ : 237934622
- WeChat : zst_1116
- Email : <zst_1116@icloud.com>
- JueJinï¼š[miaowmiaow](https://juejin.cn/user/3342971112791422)

## Thanks
æ„Ÿè°¢æ‰€æœ‰ä¼˜ç§€çš„å¼€æºé¡¹ç›® ^_^   
å¦‚æœå–œæ¬¢çš„è¯å¸Œæœ›ç»™ä¸ª Star æˆ– Fork ^_^  
è°¢è°¢~~  
